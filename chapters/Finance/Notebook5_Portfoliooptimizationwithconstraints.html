
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>11.2.2. Portfolio constraints &#8212; Quantitative Investing</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/book.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="canonical" href="https://amoreira2.github.io/quantitativeinvesting/chapters/Finance/Notebook5_Portfoliooptimizationwithconstraints.html" />
    <link rel="shortcut icon" href="../../_static/figuremain2.jpg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="12. Notebook 5" href="Notebook5_EstimationUncertainty.html" />
    <link rel="prev" title="11.2.1. Case study on international portfolio diversification" href="Notebook4_CaseStudy.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      <img src="../../_static/figuremain2.jpg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Quantitative Investing</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../01/what-is-quant-investing.html">
   1. What is Quantitative Investing?
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/statistical-techniques.html">
     1.1. Statistical Techniques
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/computational-tools.html">
     1.2. Computational tools
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/Finance.html">
     1.3. Finance
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../02/getting_started.html">
   2. Getting Started
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/local_install.html">
     2.2.1. Local installation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/cloud_setup.html">
     2.2.2. Cloud Setup
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../03/programming-in-python.html">
   3. First Steps with Python
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/1/Expressions.html">
     3.1. Expressions
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../03/2/Names.html">
     3.2. Names
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../03/2/1/Growth.html">
       3.2.1. Example: Growth Rates
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/3/Calls.html">
     3.3. Call Expressions
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../04/Data_Types.html">
     3.4. Data Types
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../04/1/Numbers.html">
       3.4.1. Numbers
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../04/2/Strings.html">
       3.4.2. Strings
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../04/3/Comparison.html">
       3.4.3. Comparisons
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../05/Sequences.html">
     3.5. Sequences
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../05/1/Arrays.html">
       3.5.1. Arrays
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../05/2/Ranges.html">
       3.5.2. Ranges
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../05/3/More_on_Arrays.html">
       3.5.3. More on Arrays
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../essentials/essentials.html">
   4. Python Essentials
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../essentials/basics.html">
     4.1. Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../essentials/collections.html">
     4.2. Collections
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../essentials/control_flow.html">
     4.3. Flow control
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../essentials/functions.html">
     4.4. Functions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../scientific/intro.html">
   5. Scientific Computing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../scientific/numpy1.html">
     5.1. Numpy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../scientific/plotting1.html">
     5.2. Plotting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../scientific/linear_algebra1.html">
     5.3. Linear algebra
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../scientific/randomness1.html">
     5.4. Randomness
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../pandas/intro.html">
   6. Working with Data
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../pandas/basics.html">
     6.7.1. Pandas Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../pandas/the_index.html">
     6.7.2. Indexing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../pandas/data_clean.html">
     6.7.3. Cleaning data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../pandas/reshape.html">
     6.7.4. Reshape
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../pandas/merge.html">
     6.7.5. Merge
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../pandas/groupby.html">
     6.7.6. Group-by
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../pandas/timeseries.html">
     6.7.7. Time-Series
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../pandas/matplotlib.html">
     6.7.8. Plotting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../pandas/storage_formats.html">
     6.7.9. Data Storage
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="Notebook3.html">
   7. Asset Returns
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Notebook3_TheChoiceofFrequency.html">
     7.5.1. The Choice of Frequency and Annualization of Returns
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook4_PortfolioMath.html">
   8. Portfolio “Math”
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook4_MeanVariance.html">
   10. The mean-variance investment frontier and the Tangency portfolio
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook5_EstimationUncertainty.html">
   12. Notebook 5
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook6A_TradingStrategies.html">
   16. Notebook 6 A
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook6A_TradingStrategies.html">
   16. Notebook 6 A
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook6B_crosssectionalequitystrategies.html">
   19. Notebook 6 B
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook5_equilibrium.html">
   21. Equilbrium Thinking
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../additional/additional.html">
   22. Additional Statistics Material
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../10/Sampling_and_Empirical_Distributions.html">
     22.1. Sampling and Empirical Distributions
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
    <label for="toctree-checkbox-12">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../10/1/Empirical_Distributions.html">
       22.1.1. Empirical Distributions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../10/2/Sampling_from_a_Population.html">
       22.1.2. Sampling from a Population
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../10/3/Empirical_Distribution_of_a_Statistic.html">
       22.1.3. Empirical Distibution of a Statistic
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../11/Testing_Hypotheses.html">
     22.2. Testing Hypotheses
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
    <label for="toctree-checkbox-13">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../11/1/Assessing_Models.html">
       22.2.1. Assessing Models
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../11/2/Multiple_Categories.html">
       22.2.2. Multiple Categories
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../11/3/Decisions_and_Uncertainty.html">
       22.2.3. Decisions and Uncertainty
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../11/4/Error_Probabilities.html">
       22.2.4. Error Probabilities
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../13/Estimation.html">
     22.3. Estimation
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
    <label for="toctree-checkbox-14">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../13/1/Percentiles.html">
       22.3.1. Percentiles
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../13/2/Bootstrap.html">
       22.3.2. The Bootstrap
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../13/3/Confidence_Intervals.html">
       22.3.3. Confidence Intervals
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../13/4/Using_Confidence_Intervals.html">
       22.3.4. Using Confidence Intervals
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../14/Why_the_Mean_Matters.html">
     22.4. Why the Mean Matters
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
    <label for="toctree-checkbox-15">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../14/1/Properties_of_the_Mean.html">
       22.4.1. Properties of the Mean
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../14/2/Variability.html">
       22.4.2. Variability
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../14/3/SD_and_the_Normal_Curve.html">
       22.4.3. The SD and the Normal Curve
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../14/4/Central_Limit_Theorem.html">
       22.4.4. The Central Limit Theorem
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../14/5/Variability_of_the_Sample_Mean.html">
       22.4.5. The Variability of the Sample Mean
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../14/6/Choosing_a_Sample_Size.html">
       22.4.6. Choosing a Sample Size
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../15/Prediction.html">
     22.5. Prediction
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
    <label for="toctree-checkbox-16">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../15/1/Correlation.html">
       22.5.1. Correlation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../15/2/Regression_Line.html">
       22.5.2. The Regression Line
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../15/3/Method_of_Least_Squares.html">
       22.5.3. The Method of Least Squares
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../15/4/Least_Squares_Regression.html">
       22.5.4. Least Squares Regression
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../15/5/Visual_Diagnostics.html">
       22.5.5. Visual Diagnostics
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../15/6/Numerical_Diagnostics.html">
       22.5.6. Numerical Diagnostics
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../16/Inference_for_Regression.html">
     22.6. Inference for Regression
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
    <label for="toctree-checkbox-17">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../16/1/Regression_Model.html">
       22.6.1. A Regression Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../16/2/Inference_for_the_True_Slope.html">
       22.6.2. Inference for the True Slope
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../16/3/Prediction_Intervals.html">
       22.6.3. Prediction Intervals
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/chapters/Finance/Notebook5_Portfoliooptimizationwithconstraints.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/amoreira2/Lectures"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/amoreira2/Lectures/issues/new?title=Issue%20on%20page%20%2Fchapters/Finance/Notebook5_Portfoliooptimizationwithconstraints.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/amoreira2/Lectures/main?urlpath=lab/tree/chapters/Finance/Notebook5_Portfoliooptimizationwithconstraints.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        <a class="jupyterhub-button" href="https://pims.syzygy.ca/jupyter/hub/user-redirect/git-pull?repo=https://github.com/amoreira2/Lectures&urlpath=lab/tree/Lectures/chapters/Finance/Notebook5_Portfoliooptimizationwithconstraints.ipynb&branch=main"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch JupyterHub" data-toggle="tooltip"
                data-placement="left"><img class="jupyterhub-button-logo"
                    src="../../_static/images/logo_jupyterhub.svg"
                    alt="Interact on JupyterHub">JupyterHub</button></a>
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/amoreira2/Lectures/blob/main/chapters/Finance/Notebook5_Portfoliooptimizationwithconstraints.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#side-note">
   11.2.2.1. Side note
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#end-of-side-note">
   11.2.2.2. End of side note
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="portfolio-constraints">
<h1><span class="section-number">11.2.2. </span>Portfolio constraints<a class="headerlink" href="#portfolio-constraints" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>Python has the flexibility to solve the mean-variance problem numerically</p></li>
<li><p>Allows you to impose realistic features to our portfolio problem</p>
<ul>
<li><p>Shorting costs</p></li>
<li><p>Borrowing costs higher than lending costs</p></li>
<li><p>Leverage constraints</p></li>
<li><p>Position limits due to investment mandates</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="c1">#GlobalFinMonthly</span>
<span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://www.dropbox.com/s/3k35mt3t57ygff2/GlobalFinMonthly.csv?dl=1&quot;</span>
<span class="n">Data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">na_values</span><span class="o">=-</span><span class="mi">99</span><span class="p">)</span>
<span class="c1"># tell python Date is date:</span>
<span class="n">Data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">Data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>
<span class="c1"># set an an index</span>
<span class="n">Data</span><span class="o">=</span><span class="n">Data</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>
<span class="n">Data</span><span class="o">=</span><span class="n">Data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">Data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="s2">&quot;MKTUS&quot;</span><span class="p">,</span><span class="n">Data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="s2">&quot;BondUS&quot;</span><span class="p">,</span>
                          <span class="n">Data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="s2">&quot;EM&quot;</span><span class="p">,</span><span class="n">Data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s2">&quot;MKTxUS&quot;</span><span class="p">,</span><span class="n">Data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="s2">&quot;BondxUS&quot;</span> <span class="p">})</span>
<span class="n">Re</span><span class="o">=</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">Data</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="n">Re</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MKTUS</th>
      <th>BondUS</th>
      <th>EM</th>
      <th>MKTxUS</th>
      <th>BondxUS</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2016-08-31</th>
      <td>0.0050</td>
      <td>-0.008617</td>
      <td>0.024986</td>
      <td>0.000638</td>
      <td>-0.009752</td>
    </tr>
    <tr>
      <th>2016-09-30</th>
      <td>0.0025</td>
      <td>-0.016617</td>
      <td>0.012953</td>
      <td>0.012536</td>
      <td>0.009779</td>
    </tr>
    <tr>
      <th>2016-10-31</th>
      <td>-0.0202</td>
      <td>-0.049660</td>
      <td>0.002274</td>
      <td>-0.020583</td>
      <td>-0.043676</td>
    </tr>
    <tr>
      <th>2016-11-30</th>
      <td>0.0486</td>
      <td>-0.081736</td>
      <td>-0.046071</td>
      <td>-0.019898</td>
      <td>-0.050459</td>
    </tr>
    <tr>
      <th>2016-12-31</th>
      <td>0.0182</td>
      <td>-0.005596</td>
      <td>0.002604</td>
      <td>0.034083</td>
      <td>-0.023507</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># start by importing optimization package -- think of a much more powerful solver (excel)</span>

<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>we will now learn how to do a numerical minimization.</p></li>
<li><p>start by defining some useful variables</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># excess returns</span>
<span class="n">Re</span><span class="o">=</span><span class="n">Data</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">Data</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">Re</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MKTUS</th>
      <th>BondUS</th>
      <th>EM</th>
      <th>MKTxUS</th>
      <th>BondxUS</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2016-08-31</th>
      <td>0.0050</td>
      <td>-0.008617</td>
      <td>0.024986</td>
      <td>0.000638</td>
      <td>-0.009752</td>
    </tr>
    <tr>
      <th>2016-09-30</th>
      <td>0.0025</td>
      <td>-0.016617</td>
      <td>0.012953</td>
      <td>0.012536</td>
      <td>0.009779</td>
    </tr>
    <tr>
      <th>2016-10-31</th>
      <td>-0.0202</td>
      <td>-0.049660</td>
      <td>0.002274</td>
      <td>-0.020583</td>
      <td>-0.043676</td>
    </tr>
    <tr>
      <th>2016-11-30</th>
      <td>0.0486</td>
      <td>-0.081736</td>
      <td>-0.046071</td>
      <td>-0.019898</td>
      <td>-0.050459</td>
    </tr>
    <tr>
      <th>2016-12-31</th>
      <td>0.0182</td>
      <td>-0.005596</td>
      <td>0.002604</td>
      <td>0.034083</td>
      <td>-0.023507</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ERe</span><span class="o">=</span><span class="n">Re</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ERe</span><span class="p">)</span>
<span class="n">Cove</span><span class="o">=</span><span class="n">Re</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Cove</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MKTUS      0.005140
BondUS     0.002523
EM         0.006923
MKTxUS     0.004149
BondxUS    0.002054
dtype: float64
            MKTUS    BondUS        EM    MKTxUS   BondxUS
MKTUS    0.001948  0.000111  0.001292  0.001264  0.000187
BondUS   0.000111  0.001227 -0.000204 -0.000013  0.000264
EM       0.001292 -0.000204  0.003556  0.001661  0.000249
MKTxUS   0.001264 -0.000013  0.001661  0.002182  0.000422
BondxUS  0.000187  0.000264  0.000249  0.000422  0.000407
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the risk-free rate is special because at a given time we know exactly what the expected returns of investing</span>
<span class="c1"># in it, since it is risk-free!</span>
<span class="c1"># so it does not make sense to use the average risk-free rate in the portfolio problem, and we should rather use the one that</span>
<span class="c1"># we currently can invest at no risk</span>
<span class="c1"># here we are dividing by 12 becasue we are using annualized numbers</span>
<span class="n">rf</span><span class="o">=</span><span class="mf">0.0192</span><span class="o">/</span><span class="mi">12</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rf</span><span class="p">)</span>

<span class="c1"># below is the target for monthly expected returns</span>
<span class="n">Ertarget</span><span class="o">=</span><span class="mf">0.06</span><span class="o">/</span><span class="mi">12</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Ertarget</span><span class="p">)</span>

<span class="c1"># below is maximum amount of borrowing at the risk-free rate. 1.5 means that for each dollar you put in you can borrow </span>
<span class="c1"># up to 50 cents and have a total risk asset portfolio of 1.5 dollars</span>
<span class="n">levlimit</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0015999999999999999
0.005
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>The program will choose a vector of weights that minimzies some function (of the chosen weights) subject to some constraint</p></li>
<li><p>we need to provide an initial condition for these weights, which essentially tells python the shape of the variable that it is choosing. Here we will start with a equal weighted portfolio</p></li>
<li><p>When solving minimization problems it is important to check that the exact initial conditions that you put in don’t matter.</p></li>
<li><p>I mean, it’s shape obviously matter, but whether is equal weighted or any other weighting scheme, the minimization should end up in the same place otherwise the numerical is not converging and you need to adjust the stop conditions</p></li>
<li><p>We refer to this as making sure that you are finding a “global optimum” and not a “local optimum”</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">=</span><span class="n">Re</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">W0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">/</span><span class="n">n</span> 
<span class="n">W0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.2, 0.2, 0.2, 0.2, 0.2])
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>We need to specify the function that our minimizer will try to minimize,i.e, our objective</p></li>
<li><p>obviously this should be written as a function of the portfolio weights</p></li>
<li><p>In this case it is the variance of a portfolio with weights W</p></li>
<li><p>the weights will be our choice variable</p></li>
<li><p>The minimization function will change the weights until this variance is minimized</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># STEP 1: define the objective function, which is the variance of the portfolio in our case</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">W</span><span class="p">,</span><span class="n">Cove</span><span class="o">=</span><span class="n">Re</span><span class="o">.</span><span class="n">cov</span><span class="p">()):</span>
    <span class="k">return</span> <span class="n">W</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Cove</span> <span class="o">@</span> <span class="n">W</span>
</pre></div>
</div>
</div>
</div>
<ul>
<li><p>Finally we need to specify the set of constraints that the minimization problem must satisfy</p></li>
<li><p>you can specify two types of constraints: Equalities and inequalities.</p></li>
<li><p>Equalities:</p>
<ul class="simple">
<li><p>specified as ‘eq’</p></li>
<li><p>For example:<code class="docutils literal notranslate"><span class="pre">{'eq',</span> <span class="pre">'fun'</span> <span class="pre">:</span> <span class="pre">lambda</span> <span class="pre">W</span> <span class="pre">:</span> <span class="pre">W.T</span> <span class="pre">&#64;</span> <span class="pre">ERe.values+rf-target}</span></code></p>
<ul>
<li><p>defines the function <code class="docutils literal notranslate"><span class="pre">F(W)=W.T</span> <span class="pre">&#64;</span> <span class="pre">ERe.values+rf-target</span></code></p></li>
<li><p>and requires W to satisfy F(W)=0, i.e., <code class="docutils literal notranslate"><span class="pre">W.T</span> <span class="pre">&#64;</span> <span class="pre">ERe.values+rf=target</span></code>, or
$<span class="math notranslate nohighlight">\(W' E[R^e]+R^f=target\)</span>$</p></li>
<li><p>“target” here is the target for expected returns</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Inequalities:</p>
<ul class="simple">
<li><p>specified as ‘ineq’</p></li>
<li><p>For example: <code class="docutils literal notranslate"><span class="pre">{'ineq',</span> <span class="pre">'fun'</span> <span class="pre">:</span> <span class="pre">lambda</span> <span class="pre">W:</span> <span class="pre">-W.sum()+levlimit}</span></code></p></li>
<li><p>Defines  <code class="docutils literal notranslate"><span class="pre">F(W)=-W.sum()+levlimit</span></code></p></li>
<li><p>and requires F(W)&gt;=0, i.e.,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[levlimit\geq W.sum()\]</div>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ERe</span><span class="o">*</span><span class="mi">12</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MKTUS      0.061684
BondUS     0.030272
EM         0.083079
MKTxUS     0.049788
BondxUS    0.024650
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Re</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MKTUS</th>
      <th>BondUS</th>
      <th>EM</th>
      <th>MKTxUS</th>
      <th>BondxUS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MKTUS</th>
      <td>1.000000</td>
      <td>0.071609</td>
      <td>0.491055</td>
      <td>0.613081</td>
      <td>0.210263</td>
    </tr>
    <tr>
      <th>BondUS</th>
      <td>0.071609</td>
      <td>1.000000</td>
      <td>-0.097846</td>
      <td>-0.007781</td>
      <td>0.373399</td>
    </tr>
    <tr>
      <th>EM</th>
      <td>0.491055</td>
      <td>-0.097846</td>
      <td>1.000000</td>
      <td>0.596177</td>
      <td>0.207206</td>
    </tr>
    <tr>
      <th>MKTxUS</th>
      <td>0.613081</td>
      <td>-0.007781</td>
      <td>0.596177</td>
      <td>1.000000</td>
      <td>0.447951</td>
    </tr>
    <tr>
      <th>BondxUS</th>
      <td>0.210263</td>
      <td>0.373399</td>
      <td>0.207206</td>
      <td>0.447951</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># STEP 2: define constraint functions, we have two constraints: (1) target average return, and (2) leverage limit</span>
<span class="n">Ertarget</span><span class="o">=</span><span class="mf">0.12</span><span class="o">/</span><span class="mi">12</span>
<span class="n">cons</span><span class="o">=</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span>
          <span class="s1">&#39;fun&#39;</span> <span class="p">:</span> <span class="k">lambda</span> <span class="n">W</span> <span class="p">:</span> <span class="n">W</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">ERe</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="n">rf</span><span class="o">-</span><span class="n">Ertarget</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ineq&#39;</span><span class="p">,</span>
          <span class="s1">&#39;fun&#39;</span> <span class="p">:</span> <span class="k">lambda</span> <span class="n">W</span><span class="p">:</span> <span class="o">-</span><span class="n">W</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">+</span><span class="n">levlimit</span><span class="p">})</span> 


<span class="n">cons</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>({&#39;type&#39;: &#39;eq&#39;, &#39;fun&#39;: &lt;function __main__.&lt;lambda&gt;(W)&gt;},
 {&#39;type&#39;: &#39;ineq&#39;, &#39;fun&#39;: &lt;function __main__.&lt;lambda&gt;(W)&gt;})
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Finally we are ready to do our minimization</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">options={'disp':</span> <span class="pre">True}</span></code>: tell python to report intermediary steps so we can check if the algorithm is doing progress towards a solution.</p></li>
<li><p>There is a variety of additional parameters that you can pass to the minimizer.</p></li>
<li><p>see: <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize.html">https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize.html</a></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># STEP 3: solve the minimization problem with constraints and save as `sol`</span>

<span class="n">sol</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">Cove</span><span class="o">=</span><span class="n">Re</span><span class="o">.</span><span class="n">cov</span><span class="p">()),</span><span class="n">W0</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">cons</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;disp&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization terminated successfully    (Exit mode 0)
            Current function value: 0.0044263793644412665
            Iterations: 7
            Function evaluations: 42
            Gradient evaluations: 7
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.999999998431648
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#skip</span>
<span class="c1"># Retemp=Re.iloc[:,0:4].copy()</span>
<span class="c1"># n=Retemp.shape[1]</span>
<span class="c1"># W0=np.ones(n)/n </span>
<span class="c1"># W0</span>

<span class="c1"># def func(W,Cove=Re.cov()):</span>
<span class="c1">#     return W.T @ Cove @ W</span>

<span class="c1"># cons=({&#39;type&#39;: &#39;eq&#39;,</span>
<span class="c1">#           &#39;fun&#39; : lambda W : W.T @ Retemp.mean().values+rf-Ertarget},</span>
<span class="c1">#         {&#39;type&#39;: &#39;ineq&#39;,</span>
<span class="c1">#           &#39;fun&#39; : lambda W: -W.sum()+levlimit}) </span>
<span class="c1"># sol = minimize(lambda x: func(x,Cove=Retemp.cov()),W0, constraints=cons, options={&#39;disp&#39;: True})</span>
<span class="c1"># sol.x</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># STEP 4: get the optimal portfolio weights</span>

<span class="n">sol</span><span class="o">.</span><span class="n">x</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 0.76797288,  0.42185164,  0.96139604, -0.431085  , -0.72013556])
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Solution is saved in sol</p></li>
<li><p>Lets plot the optimal weights</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># below I am plotting the solution weights.</span>
<span class="n">width</span><span class="o">=</span><span class="mf">0.3</span>
<span class="n">ind</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Re</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">width</span><span class="p">)</span>

<span class="c1"># ax.set_xticks(np.array([0,1,2,3,4,5])+ width / 2)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">Re</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Notebook5_Portfoliooptimizationwithconstraints_21_0.png" src="../../_images/Notebook5_Portfoliooptimizationwithconstraints_21_0.png" />
</div>
</div>
<ul class="simple">
<li><p>We can now use a for loop to trace out the entire mean-variance frontier when neither borrowing or lending at the risk-free rate is allowed</p></li>
<li><p>we do this by minimizing the variance with different targets for expected returns</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">expected_return</span><span class="p">(</span><span class="n">W</span><span class="p">):</span>
     <span class="k">return</span> <span class="n">W</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">ERe</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="p">((</span><span class="n">W</span><span class="p">[</span><span class="n">W</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">fee</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">+</span><span class="n">rf</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># here we constructing a list of target ranging from the risk-free rate until 12%, </span>
<span class="c1"># with 40 equally distanced points in between</span>
<span class="n">levlimit</span><span class="o">=</span><span class="mi">40</span>
<span class="n">mutargets</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span><span class="mf">0.50</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="n">spread</span><span class="o">=</span><span class="mf">0.02</span><span class="o">/</span><span class="mi">12</span>
<span class="c1"># We are initiating a list where we will be storing the results</span>
<span class="n">minstd</span><span class="o">=</span><span class="p">[]</span>

<span class="c1"># we now simply loop over the different expected return targets in the vector which we just constructed</span>

<span class="n">fee</span><span class="o">=</span><span class="mf">0.05</span><span class="o">/</span><span class="mi">12</span>

<span class="k">for</span> <span class="n">a0</span> <span class="ow">in</span> <span class="n">mutargets</span><span class="p">:</span>
    <span class="c1">#   1. The loop fisrt define the new constraint with the new expected return target given by a0</span>
    <span class="n">cons</span><span class="o">=</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span>
          <span class="s1">&#39;fun&#39;</span> <span class="p">:</span> <span class="k">lambda</span> <span class="n">W</span> <span class="p">:</span> <span class="n">W</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">ERe</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="n">W</span><span class="p">[</span><span class="n">W</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">fee</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">+</span><span class="n">rf</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">W</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">spread</span><span class="o">-</span><span class="n">a0</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ineq&#39;</span><span class="p">,</span>
          <span class="s1">&#39;fun&#39;</span> <span class="p">:</span> <span class="k">lambda</span> <span class="n">W</span><span class="p">:</span> <span class="o">-</span><span class="n">W</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">levlimit</span><span class="p">}</span> <span class="p">,</span>
        <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ineq&#39;</span><span class="p">,</span>
          <span class="s1">&#39;fun&#39;</span> <span class="p">:</span> <span class="k">lambda</span> <span class="n">W</span><span class="p">:</span> <span class="n">W</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]]})</span>
    <span class="c1">#   2. It then performs the minimization</span>
    <span class="n">res1</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="n">W0</span><span class="p">,</span>  <span class="n">constraints</span><span class="o">=</span><span class="n">cons</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;disp&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span><span class="n">tol</span><span class="o">=</span><span class="mf">0.00000000000001</span><span class="p">)</span>
<span class="c1">#    print(res1.x)</span>
    <span class="c1">#   3. Finally it appends the solution to the list that we just created. </span>
    <span class="c1">#        Here we are saving the square root of the objective function, which is simply the standard deviaiton </span>
    <span class="c1">#        of the optimal portfolio. And the also the expected return obtained (alternatively we could have simply saved a0)</span>
    <span class="n">minstd</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">res1</span><span class="o">.</span><span class="n">fun</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span><span class="n">res1</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">ERe</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="n">res1</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">res1</span><span class="o">.</span><span class="n">x</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">fee</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">+</span><span class="n">rf</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">res1</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">spread</span><span class="p">,</span><span class="n">res1</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span><span class="n">res1</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()])</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>We can now plot the mean-standard-deviation frontiers by plotting the obtained standard deviation in the x-axis and the obtained expected returns in the y-axis</p></li>
</ul>
<div class="section" id="side-note">
<h2><span class="section-number">11.2.2.1. </span>Side note<a class="headerlink" href="#side-note" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">levlimit</span><span class="o">=</span><span class="mi">0</span>
<span class="n">rf</span><span class="o">=</span><span class="mi">0</span>
<span class="n">mutargets</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span><span class="mf">0.50</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="n">minstd</span><span class="o">=</span><span class="p">[]</span>
<span class="n">a0</span><span class="o">=</span><span class="mf">0.5</span><span class="o">/</span><span class="mi">12</span>
<span class="n">cons</span><span class="o">=</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span>
      <span class="s1">&#39;fun&#39;</span> <span class="p">:</span> <span class="k">lambda</span> <span class="n">W</span> <span class="p">:</span> <span class="n">W</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">ERe</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="n">rf</span><span class="o">-</span><span class="n">a0</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ineq&#39;</span><span class="p">,</span>
      <span class="s1">&#39;fun&#39;</span> <span class="p">:</span> <span class="k">lambda</span> <span class="n">W</span><span class="p">:</span> <span class="o">-</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">levlimit</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ineq&#39;</span><span class="p">,</span>
          <span class="s1">&#39;fun&#39;</span> <span class="p">:</span> <span class="k">lambda</span> <span class="n">W</span><span class="p">:</span> <span class="n">W</span><span class="p">}</span> <span class="p">)</span>

<span class="n">res1</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="n">W0</span><span class="p">,</span>  <span class="n">constraints</span><span class="o">=</span><span class="n">cons</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;disp&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span><span class="n">tol</span><span class="o">=</span><span class="mf">0.00000000000001</span><span class="p">)</span>
<span class="n">prnt</span><span class="p">([(</span><span class="n">res1</span><span class="o">.</span><span class="n">fun</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">12</span><span class="o">*</span><span class="p">(</span><span class="n">res1</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">ERe</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="n">rf</span><span class="p">),</span><span class="n">res1</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span><span class="n">res1</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res1</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res1</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.2065811327215539,
 0.08307943849270083,
 1.0000000000010738,
 -9.326593771415994e-12]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Re</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[&lt;matplotlib.axes._subplots.AxesSubplot object at 0x0000018565D4B7C0&gt;,
        &lt;matplotlib.axes._subplots.AxesSubplot object at 0x0000018565D44910&gt;],
       [&lt;matplotlib.axes._subplots.AxesSubplot object at 0x0000018565B9FB50&gt;,
        &lt;matplotlib.axes._subplots.AxesSubplot object at 0x000001856586E340&gt;],
       [&lt;matplotlib.axes._subplots.AxesSubplot object at 0x0000018565975A90&gt;,
        &lt;matplotlib.axes._subplots.AxesSubplot object at 0x0000018565F2F2B0&gt;]],
      dtype=object)
</pre></div>
</div>
<img alt="../../_images/Notebook5_Portfoliooptimizationwithconstraints_28_1.png" src="../../_images/Notebook5_Portfoliooptimizationwithconstraints_28_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">=</span><span class="n">Re</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;topleft&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;topright&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;bottomleft&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;bottomleft&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;middleleft&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;middleright&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-56-129b3aac83d8&gt;:2: UserWarning: To output multiple subplots, the figure containing the passed axes is being cleared
  ax=Re.hist(ax=ax)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;middleright&#39;)
</pre></div>
</div>
<img alt="../../_images/Notebook5_Portfoliooptimizationwithconstraints_29_2.png" src="../../_images/Notebook5_Portfoliooptimizationwithconstraints_29_2.png" />
</div>
</div>
</div>
<div class="section" id="end-of-side-note">
<h2><span class="section-number">11.2.2.2. </span>End of side note<a class="headerlink" href="#end-of-side-note" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span> <span class="n">W</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">ERe</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="n">rf</span><span class="o">-</span><span class="n">a0</span>
    
 <span class="n">W</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">ERe</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="n">W</span><span class="p">[</span><span class="n">W</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">fee</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">+</span><span class="n">rf</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">W</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">spread</span><span class="o">-</span><span class="n">a0</span>    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">minstd</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[3.591478745103494e-10,
  0.001600000036585007,
  1.781025499303368e-08,
  -1.6653345369377348e-16],
 [0.004207416985664804,
  0.0020421052943131253,
  0.19129790813922426,
  -1.1102230246251565e-16],
 [0.006901028123669531, 0.002484210553424129, 0.31716245547822475, 0.0],
 [0.009590358998671557,
  0.0029263158127647098,
  0.4239283981016745,
  0.008171011448185855],
 [0.01215583166575831,
  0.003368421072285655,
  0.5139028150695928,
  0.03813422380414419],
 [0.014942762248227114,
  0.0038105263318065994,
  0.603877232037511,
  0.06809743616010255],
 [0.01784770814658756,
  0.004252631591327546,
  0.6938516490054296,
  0.09806064851606093],
 [0.02082133211210155,
  0.00469473685084849,
  0.7838260659733478,
  0.12802386087201925],
 [0.02383794660026387,
  0.005136842110369436,
  0.8738004829412662,
  0.15798707322797761],
 [0.02688308329915989,
  0.00557894736989038,
  0.9637748999091845,
  0.18795028558393595],
 [0.029948043000838035,
  0.006021052629411326,
  1.053749316877103,
  0.205481223888636],
 [0.03302730739628128,
  0.006463157888932271,
  1.1437237338450212,
  0.2143713738432866],
 [0.033294709975364295,
  0.006905263157000248,
  1.3546104092627949,
  -2.7755575615628914e-17],
 [0.036083667034289814,
  0.007347368415523701,
  1.4661299157221996,
  -2.7755575615628914e-17],
 [0.038895849422875634, 0.007789473683808443, 1.5, -1.734723475976807e-18],
 [0.04222325131944657, 0.00823157895061917, 1.5, -2.7755575615628914e-17],
 [0.04592870451611372, 0.008673684199279986, 1.5, 1.1102230246251565e-16],
 [0.04992452961061417, 0.009115789478100978, 1.5, -4.163336342344337e-17],
 [0.054158861383639574,
  0.00955789474007607,
  1.5000000000000002,
  1.1102230246251565e-16],
 [0.05909644202938371, 0.01000000000417816, 1.5, 2.710505431213761e-18]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">minstd</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">minstd</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Volatility&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Average return&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Notebook5_Portfoliooptimizationwithconstraints_33_0.png" src="../../_images/Notebook5_Portfoliooptimizationwithconstraints_33_0.png" />
</div>
</div>
<ul class="simple">
<li><p>You can do a multitude of different problems by making small changes to this code:</p>
<ul>
<li><p>Borrowing at the risk-free rate is not allowed,  but lending is allowed</p></li>
<li><p>Shorting of any asset is not allowed</p></li>
<li><p>Shorting of some assets are not allowed</p></li>
<li><p>Shorting has an extra cost</p></li>
<li><p>Leverage is allowed, but borrowing rate is higher than risk-free rate</p></li>
</ul>
</li>
</ul>
<blockquote>
<div><p>How would you implement no shorting of any asset?</p>
</div></blockquote>
<blockquote>
<div><p>How would you implement no shorting of bonds, but allow investor to short equity markets (which can be done using futures)?</p>
</div></blockquote>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./chapters/Finance"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="Notebook4_CaseStudy.html" title="previous page"><span class="section-number">11.2.1. </span>Case study on international portfolio diversification</a>
    <a class='right-next' id="next-link" href="Notebook5_EstimationUncertainty.html" title="next page"><span class="section-number">12. </span>Notebook 5</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Alan Moreira<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
    
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>


    
  </body>
</html>