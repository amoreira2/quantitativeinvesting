
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Notebook 4 &#8212; Quantitative Investing</title>
    
  <link rel="stylesheet" href="../../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.e7340bb3dbd8dde6db86f25597f54a1b.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/book.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="canonical" href="https://amoreira2.github.io/quantitativeinvesting/chapters/Finance/Notebook4_MeanVariance.html" />
    <link rel="shortcut icon" href="../../_static/figuremain2.jpg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />


<!-- Opengraph tags -->
<meta property="og:url"         content="https://amoreira2.github.io/quantitativeinvesting/chapters/Finance/Notebook4_MeanVariance.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Notebook 4" />
<meta property="og:description" content="Notebook 4  Topics covered    Portfolio math  Diversification  Capital allocation line  Mean-variance frontier  Tangency portfolio  Two-fund separation  Case st" />
<meta property="og:image"       content="https://amoreira2.github.io/quantitativeinvesting/_static/figuremain2.jpg" />

<meta name="twitter:card" content="summary" />


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/figuremain2.jpg" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Quantitative Investing</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../01/what-is-quant-investing.html">
   1. What is Quantitative Investing?
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../01/statistical-techniques.html">
     1.1. Statistical Techniques
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/computational-tools.html">
     1.2. Computational tools
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01/Finance.html">
     1.3. Finance
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../02/getting_started.html">
   2. Getting Started
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../02/local_install.html">
     2.2.1. Local installation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/cloud_setup.html">
     2.2.2. Cloud Setup
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../03/programming-in-python.html">
   3. First Steps with Python
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../03/1/Expressions.html">
     3.1. Expressions
    </a>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../03/2/Names.html">
     3.2. Names
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../03/2/1/Growth.html">
       3.2.1. Example: Growth Rates
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/3/Calls.html">
     3.3. Call Expressions
    </a>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../04/Data_Types.html">
     3.4. Data Types
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../04/1/Numbers.html">
       3.4.1. Numbers
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../04/2/Strings.html">
       3.4.2. Strings
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../04/3/Comparison.html">
       3.4.3. Comparisons
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../05/Sequences.html">
     3.5. Sequences
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../05/1/Arrays.html">
       3.5.1. Arrays
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../05/2/Ranges.html">
       3.5.2. Ranges
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../05/3/More_on_Arrays.html">
       3.5.3. More on Arrays
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../essentials/essentials.html">
   4. Python Essentials
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../essentials/basics.html">
     4.1. Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../essentials/collections.html">
     4.2. Collections
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../essentials/control_flow.html">
     4.3. Flow control
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../essentials/functions.html">
     4.4. Functions
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../scientific/intro.html">
   5. Scientific Computing
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../scientific/numpy1.html">
     5.1. Numpy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../scientific/plotting1.html">
     5.2. Plotting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../scientific/linear_algebra1.html">
     5.3. Linear algebra
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../scientific/randomness1.html">
     5.4. Randomness
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../pandas/intro.html">
   6. Working with Data
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../pandas/basics.html">
     6.7.1. Pandas Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../pandas/the_index.html">
     6.7.2. Indexing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../pandas/data_clean.html">
     6.7.3. Cleaning data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../pandas/reshape.html">
     6.7.4. Reshape
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../pandas/merge.html">
     6.7.5. Merge
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../pandas/groupby.html">
     6.7.6. Group-by
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../pandas/timeseries.html">
     6.7.7. Time-Series
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../pandas/matplotlib.html">
     6.7.8. Plotting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../pandas/storage_formats.html">
     6.7.9. Data Storage
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../additional/additional.html">
   7. Additional Statistics Material
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../10/Sampling_and_Empirical_Distributions.html">
     7.1. Sampling and Empirical Distributions
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../10/1/Empirical_Distributions.html">
       7.1.1. Empirical Distributions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../10/2/Sampling_from_a_Population.html">
       7.1.2. Sampling from a Population
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../10/3/Empirical_Distribution_of_a_Statistic.html">
       7.1.3. Empirical Distibution of a Statistic
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../11/Testing_Hypotheses.html">
     7.2. Testing Hypotheses
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../11/1/Assessing_Models.html">
       7.2.1. Assessing Models
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../11/2/Multiple_Categories.html">
       7.2.2. Multiple Categories
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../11/3/Decisions_and_Uncertainty.html">
       7.2.3. Decisions and Uncertainty
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../11/4/Error_Probabilities.html">
       7.2.4. Error Probabilities
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../13/Estimation.html">
     7.3. Estimation
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../13/1/Percentiles.html">
       7.3.1. Percentiles
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../13/2/Bootstrap.html">
       7.3.2. The Bootstrap
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../13/3/Confidence_Intervals.html">
       7.3.3. Confidence Intervals
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../13/4/Using_Confidence_Intervals.html">
       7.3.4. Using Confidence Intervals
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../14/Why_the_Mean_Matters.html">
     7.4. Why the Mean Matters
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../14/1/Properties_of_the_Mean.html">
       7.4.1. Properties of the Mean
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../14/2/Variability.html">
       7.4.2. Variability
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../14/3/SD_and_the_Normal_Curve.html">
       7.4.3. The SD and the Normal Curve
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../14/4/Central_Limit_Theorem.html">
       7.4.4. The Central Limit Theorem
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../14/5/Variability_of_the_Sample_Mean.html">
       7.4.5. The Variability of the Sample Mean
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../14/6/Choosing_a_Sample_Size.html">
       7.4.6. Choosing a Sample Size
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../15/Prediction.html">
     7.5. Prediction
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../15/1/Correlation.html">
       7.5.1. Correlation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../15/2/Regression_Line.html">
       7.5.2. The Regression Line
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../15/3/Method_of_Least_Squares.html">
       7.5.3. The Method of Least Squares
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../15/4/Least_Squares_Regression.html">
       7.5.4. Least Squares Regression
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../15/5/Visual_Diagnostics.html">
       7.5.5. Visual Diagnostics
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../15/6/Numerical_Diagnostics.html">
       7.5.6. Numerical Diagnostics
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../16/Inference_for_Regression.html">
     7.6. Inference for Regression
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../16/1/Regression_Model.html">
       7.6.1. A Regression Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../16/2/Inference_for_the_True_Slope.html">
       7.6.2. Inference for the True Slope
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../16/3/Prediction_Intervals.html">
       7.6.3. Prediction Intervals
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/chapters/Finance/Notebook4_MeanVariance.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/amoreira2/Lectures"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/amoreira2/Lectures/issues/new?title=Issue%20on%20page%20%2Fchapters/Finance/Notebook4_MeanVariance.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/amoreira2/Lectures/main?urlpath=lab/tree/chapters/Finance/Notebook4_MeanVariance.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        <a class="jupyterhub-button" href="https://pims.syzygy.ca/jupyter/hub/user-redirect/git-pull?repo=https://github.com/amoreira2/Lectures&urlpath=lab/tree/Lectures/chapters/Finance/Notebook4_MeanVariance.ipynb&branch=main"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch JupyterHub" data-toggle="tooltip"
                data-placement="left"><img class="jupyterhub-button-logo"
                    src="../../_static/images/logo_jupyterhub.svg"
                    alt="Interact on JupyterHub">JupyterHub</button></a>
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/amoreira2/Lectures/blob/main/chapters/Finance/Notebook4_MeanVariance.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Notebook 4
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#topics-covered">
     Topics covered
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-mean-variance-investment-frontier-and-the-tangency-portfolio">
   The mean-variance investment frontier and the Tangency portfolio
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mean-variance-frontier">
     Mean-variance Frontier
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-tangecy-portfolio">
     The Tangecy  portfolio
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       $
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#aside-matrix-inversion-intuition">
       Aside: Matrix inversion intuition
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#two-fund-separation">
       Two-fund separation
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#the-tangency-portfolio-and-the-cross-sectional-of-expected-returns">
       The tangency portfolio and the cross-sectional of expected returns
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#portfolio-advice-summary">
       Portfolio advice summary
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#the-1-trillion-dollar-question-what-is-the-tangency-portfolio-how-to-find-it">
       The 1 trillion dollar question: What is the Tangency portfolio? How to find it?
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#case-study-on-international-portfolio-diversification">
   Case study on international portfolio diversification
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#class-11-17-stopped-here">
     Class 11/17 stopped here
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#aside-when-is-it-ok-to-normalize-weights">
     Aside: When is it ok to “normalize” weights?
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <img src='https://www.dropbox.com/s/125k1wnxkl6bgs0/class_logo.jpg?dl=1' alt="Smiley face" align="center" style="width: 600px;"/>
<div class="section" id="notebook-4">
<h1>Notebook 4<a class="headerlink" href="#notebook-4" title="Permalink to this headline">¶</a></h1>
<div class="section" id="topics-covered">
<h2>Topics covered<a class="headerlink" href="#topics-covered" title="Permalink to this headline">¶</a></h2>
<hr class="docutils" />
<ul class="simple">
<li><p>Portfolio math</p></li>
<li><p>Diversification</p></li>
<li><p>Capital allocation line</p></li>
<li><p>Mean-variance frontier</p></li>
<li><p>Tangency portfolio</p></li>
<li><p>Two-fund separation</p></li>
<li><p>Case study on international diversification</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="c1">#GlobalFinMonthly</span>
<span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://www.dropbox.com/s/3k35mt3t57ygff2/GlobalFinMonthly.csv?dl=1&quot;</span>
<span class="c1"># url=&quot;C:/Users/Alan Moreira/Dropbox/Public/Fin418/Data/GlobalFinMonthly.csv&quot;</span>
<span class="n">Data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">na_values</span><span class="o">=-</span><span class="mi">99</span><span class="p">)</span>
<span class="c1"># tell python Date is date:</span>
<span class="n">Data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">Data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>
<span class="c1"># set an an index</span>
<span class="n">Data</span><span class="o">=</span><span class="n">Data</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="o">=</span><span class="n">Data</span><span class="p">[[</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="s1">&#39;MKT&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="the-mean-variance-investment-frontier-and-the-tangency-portfolio">
<h1>The mean-variance investment frontier and the Tangency portfolio<a class="headerlink" href="#the-mean-variance-investment-frontier-and-the-tangency-portfolio" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>Note the upper envelope that defines the “investment frontier”, i.e., what is achiavable in terms of risk and returns</p></li>
<li><p>If you are in this envelope, you know that in order to get less risk you will have to get less return</p></li>
<li><p>There is no portfolio with a higher average return and the same volatility</p></li>
<li><p>And no portfolio with the same expected return and lower volatility</p></li>
<li><p>In volatility-expected return space all these portfolio are in a straight line,</p></li>
<li><p>Meaning that they achieve exactly the same ratio or expected excess return per unit of volatility since a stragith line has constant slope</p></li>
<li><p>So all these portfolios have exactly the same Sharpe ratio (<span class="math notranslate nohighlight">\(\frac{E[R_p-R_f]}{std(R_p-R_f)}\)</span>),</p></li>
<li><p>This is also the maximum SR among all possible portfolios of the basis assets</p>
<ul>
<li><p>(in this case only two: US and world portfolio)</p></li>
</ul>
</li>
</ul>
<blockquote>
<div><p>What do these “efficient” portfolios look like?</p>
</div></blockquote>
<div class="section" id="mean-variance-frontier">
<h2>Mean-variance Frontier<a class="headerlink" href="#mean-variance-frontier" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>These portfolios all can be thought as minimizing variance/volatility for a given desired expected return</p></li>
<li><p>or maximizing expected returns for a given dislike of variance</p></li>
<li><p>Formally they solve the following minimization problem</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
maximize_{W,w_f} rf+ (1-w_f)E[W'R^e]- \gamma Var((1-w_f)W'R^e+r_f)\\
maximize_{W,w_f} rf+ (1-w_f)W'E[R^e]- \gamma (1-w_f)^2W'Var(R^e)W\\
\end{aligned}
\end{split}\]</div>
<ul class="simple">
<li><p>If you understand calculus the answer is immediate.</p></li>
<li><p>All you need is to take the derivative of the expression with respect to the risky portfolio weights <span class="math notranslate nohighlight">\(W\)</span> :</p></li>
</ul>
<div class="math notranslate nohighlight">
\[(1-w_f)E[R^e]- 2\gamma(1-w_f)^2 Var(R^e)W\]</div>
<ul class="simple">
<li><p>and impose the “first order condition”:
$<span class="math notranslate nohighlight">\(
\begin{aligned}
(1-w_f)E[R^e]- 2\gamma(1-w_f)^2 Var(R^e)W^*=0
\end{aligned}
\)</span>$</p></li>
<li><p>which simply means that if <span class="math notranslate nohighlight">\(W^*\)</span> is really the weight that minimizes the expression, if you move it a little bit in any direction, the value of the expression shouldn’t move much</p></li>
<li><p>In fact, for a tiny move in either direction, the benefit should be zero either way</p></li>
<li><p>Here is the intuition:</p>
<ul>
<li><p>Lets consider that we want to find the x that maximizes: <span class="math notranslate nohighlight">\(4x-x^2\)</span></p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">4</span><span class="o">*</span><span class="n">x</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>This is maximized at 2</p></li>
<li><p>The FOC for this case is simply</p></li>
</ul>
<div class="math notranslate nohighlight">
\[4-2x^*=0\]</div>
<ul class="simple">
<li><p>Which means <span class="math notranslate nohighlight">\(x^*=2\)</span></p></li>
<li><p>You see in the plot that pertubating x a little bit has not effect on the value</p></li>
<li><p>close to the optimal, the expression is flat.</p></li>
<li><p>This is a general result</p></li>
</ul>
</div>
<div class="section" id="the-tangecy-portfolio">
<h2>The Tangecy  portfolio<a class="headerlink" href="#the-tangecy-portfolio" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Rewriting our first order condition we have</p></li>
</ul>
<div class="section" id="id1">
<h3>$<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>\begin{align}
2\gamma(1-w_f)^2 Var(R^e)W^* &amp;=(1-w_f)E[R^e]\
(2\gamma (1-w_f)^2Var(R^e))^{-1}2\gamma(1-w_f)^2 Var(R^e)W^* &amp;=(2\gamma (1-w_f)^2Var(R^e))^{-1}(1-w_f)E[R^e]\
W^* &amp;=\frac{1}{2\gamma(1-w_f)}(Var(R^e))^{-1}E[R^e]
\end{align}$</p>
<ul class="simple">
<li><p>Does your distaste for risk <span class="math notranslate nohighlight">\(\gamma\)</span> impact your portfolio composition?</p></li>
<li><p>Does it impact the relative weights in the risky assets?</p></li>
<li><p>Does your choice of how much to invest in the risk-free asset <span class="math notranslate nohighlight">\(w_f\)</span> impacts the composition of your risky portfolio?</p></li>
<li><p>Note that <span class="math notranslate nohighlight">\(W^*\)</span> is the optimal position in risky assets and therefore has the same dimension as the number of assets you are considering.</p></li>
<li><p>In our simple case 2 assets</p></li>
<li><p>Note that <span class="math notranslate nohighlight">\(\frac{1}{2\gamma(1-w_f)}\)</span> is a scalar, which means that this is a number not a vector</p></li>
</ul>
</div>
<div class="section" id="aside-matrix-inversion-intuition">
<h3>Aside: Matrix inversion intuition<a class="headerlink" href="#aside-matrix-inversion-intuition" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Note that <span class="math notranslate nohighlight">\((2)^{-1}=1/2=0.5\)</span> (naturally!), <span class="math notranslate nohighlight">\((Var(R^e))^{-1}\)</span> is kind of like this,</p></li>
<li><p>but more complicated because <span class="math notranslate nohighlight">\(Var(R^e)\)</span> is a N by N matrix and we can’t simply divide over</p></li>
<li><p>The definition of the inverse function is <span class="math notranslate nohighlight">\(f(x)=x^{-1}=y\)</span> where <span class="math notranslate nohighlight">\(y*x=1\)</span></p></li>
<li><p>for matrixis it is the same: <span class="math notranslate nohighlight">\((Var(R^e))^{-1}Var(R^e)=I\)</span>, but now instead of 1, we have an indentity matrix, which is a matrix with 1’s in the diagonal and zero everywhere else</p></li>
<li><p>For example, lets say we want to inverse a 2 by 2 matrix:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}\left[\begin{array}{cc}3 &amp; 7\\0 &amp;9\end{array}\right]^{-1}=\left[\begin{array}{cc}a &amp; b\\c &amp;d\end{array}\right]\end{split}\]</div>
<ul class="simple">
<li><p>We would simply solve</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}\left[\begin{array}{cc}3 &amp; 7\\0 &amp;9\end{array}\right]\left[\begin{array}{cc}a &amp; b\\c &amp;d\end{array}\right]=I=\left[\begin{array}{cc}1 &amp; 0\\0 &amp;1\end{array}\right]\end{split}\]</div>
<ul class="simple">
<li><p>Which means solving this system of four equations below
$<span class="math notranslate nohighlight">\(
\begin{aligned}
3*a+7*c=1\\
3*b+7*d=0\\
0*a+9*c=0\\
0*b+9*d=1\\
\end{aligned}\)</span>$</p></li>
<li><p>which in this case has an easy solution [a,b,c,d]=[1/3,-7/27,0,1/9]</p></li>
<li><p>But we should be thankful for being born after the 70’s, when people had to do these inversions by hand–for very large matrixes</p></li>
<li><p>Now we can simply us the linear algebra library build in numpy  we discussed in Notebook 1 and invert the matrix:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">9</span><span class="p">]])</span>
<span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">@</span> <span class="n">a</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Re</span><span class="o">.</span><span class="n">cov</span><span class="p">())</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">@</span> <span class="n">a</span>
</pre></div>
</div>
</div>
</div>
<p>And our optimal weights must be proportional to</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Wstar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Re</span><span class="o">.</span><span class="n">cov</span><span class="p">())</span> <span class="o">@</span> <span class="n">Re</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">Wstar</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Re</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Re</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>But these weights don’t add up to one?</p></li>
<li><p>Why does this still make sense? Why these weights define a portfolio?</p></li>
<li><p>Cacluating weights below for a fully invested portfolio</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Wstar</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Wstar</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="two-fund-separation">
<h3>Two-fund separation<a class="headerlink" href="#two-fund-separation" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Take a moment to appreciate this.</p></li>
<li><p>How you distribute your wealth across different risky assets DOES NOT depend on your preferences for risk!</p></li>
<li><p>It DOES NOT depend on how much you are investing in the risk-free rate</p></li>
<li><p>We can go back and now solve to the position in the risky-free asset and the risk portfolio</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
maximize_{w_f} rf+ (1-w_f)E[R^*]- (1-w_f)^2\gamma Var(R^*)\\
\end{aligned}
\end{split}\]</div>
<ul class="simple">
<li><p>Where <span class="math notranslate nohighlight">\(R^*=(W^*)'R^e\)</span> is the returns on the optimal risk portfolio (the TANGENCY portfolio)</p></li>
<li><p>The First order condition for <span class="math notranslate nohighlight">\(w_f\)</span> is simply</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
-E[R^*]+ 2(1-w_f)\gamma Var(R^*)=0\\
 (1-w_f)=\frac{1}{2\gamma}\frac{E[R^*]}{Var(R^*)}
\end{aligned}
\end{split}\]</div>
<ul>
<li><p>Note that now we can divide over the variance term, becasue it is the variance of one asset, our portfolio, which is just a scalar</p></li>
<li><p>Recall that <span class="math notranslate nohighlight">\(1-w_f\)</span> is the position of the optimal risky portfolio (the TANGENCY portfolio)</p></li>
<li><p>So this formula has a lot of intuition:</p>
<ul class="simple">
<li><p>Your position on the risky portfolio depends:</p>
<ul>
<li><p>on your distaste for risk <span class="math notranslate nohighlight">\((2\gamma)\)</span></p></li>
<li><p>The risk-return trade-off on your  risky portfolio</p></li>
<li><p>Recall that the optimal risky portfolio is the portfolio with best risk-return trade-off !</p></li>
</ul>
</li>
</ul>
</li>
<li><p>You can also rewrite the solution in terms of your choice of your overall portfolio volatility,</p></li>
<li><p>which is <span class="math notranslate nohighlight">\((1-w_f)std(R^*)\)</span></p>
<div class="math notranslate nohighlight">
\[ (1-w_f)std(R^*)=\frac{1}{2\gamma}\frac{E[R^*]}{std(R^*)}\]</div>
</li>
<li><p>So your position on the risky asset depends on the Sharpe ratio of your risky portfolio</p></li>
<li><p>Note that we can simply define the tangency portfolio as :</p></li>
</ul>
<div class="math notranslate nohighlight">
\[W^*=(Var(R^e))^{-1}E[R^e]\]</div>
<ul class="simple">
<li><p>Because any constant term will simply change the position in the risky-free asset</p></li>
<li><p>For example, since any constant multiplying <span class="math notranslate nohighlight">\(W^*\)</span> does not change it’s sharpe ratio (can you show that?),</p></li>
<li><p>then from the equation above it is immediate that a more volatile <span class="math notranslate nohighlight">\(R^*\)</span> would simply imply a higher position in the risk-free asset, keeping the total portfolio volatility constant.</p></li>
</ul>
</div>
<div class="section" id="the-tangency-portfolio-and-the-cross-sectional-of-expected-returns">
<h3>The tangency portfolio and the cross-sectional of expected returns<a class="headerlink" href="#the-tangency-portfolio-and-the-cross-sectional-of-expected-returns" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The optimal condition for our tangency portfolio:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[ Var(R^e)W^*=cte \times E[R^e]\]</div>
<ul class="simple">
<li><p>This condition above defines the tangency portfolio</p></li>
<li><p>We can rewirte the left hand side as</p></li>
</ul>
<div class="math notranslate nohighlight">
\[Var(R^e)W^*=Cov(R^e,R^e)W^*=Cov(R^e,(W^*)'R^e)=Cov(R^e,R^*)\]</div>
<ul class="simple">
<li><p>The left-hand side in the covariance vector of all the assets with the tangency portfolio</p></li>
<li><p>This means that the expected return of an asset must be proportional to the covariance between the return of the asset and the return of the tangency portfolio</p></li>
</ul>
<div class="math notranslate nohighlight">
\[ E[R^e]=cte \times Cov(R^e,R^*) \]</div>
<ul class="simple">
<li><p>This holds for all assets in your investment opportunity set (i.e. the assets included in the minimization problem that the tangency portfolio solves)</p></li>
<li><p>This means that for any assets <span class="math notranslate nohighlight">\(j\)</span> and <span class="math notranslate nohighlight">\(i\)</span> we have</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\frac{E[R^e_i]}{Cov(R^e_i,R^*)}= \frac{E[R^e_j]}{Cov(R^e_j,R^*)} \]</div>
<ul class="simple">
<li><p>All assets have the same expected return per-unit of covariance with the tangency portoflio</p></li>
<li><p>We can also apply this to the tangency portfolio itself</p></li>
</ul>
<div class="math notranslate nohighlight">
\[ E[R^*]=cte \times Cov(R^*,R^*) \]</div>
<ul class="simple">
<li><p>Which means that <span class="math notranslate nohighlight">\(cte=\frac{E[R^*]}{Var(R^*)}\)</span></p></li>
<li><p>Plugging back in the original and we get that for any asset <span class="math notranslate nohighlight">\(j\)</span></p></li>
</ul>
<div class="math notranslate nohighlight">
\[ E[R^e_j]=\frac{E[R^*]}{Var(R^*)} Cov(R^e_j,R^*) =\frac{Cov(R^e_j,R^*)}{Var(R^*)}E[R^*]=\beta_{j,*}E[R^*] \]</div>
<div class="math notranslate nohighlight">
\[ E[R^e_j]=\beta_{j,*}E[R^*] \]</div>
<blockquote>
<div><p>What does that remind you?</p>
</div></blockquote>
<ul class="simple">
<li><p>All the information about the cross-sectional of expected returns–all the assets– can be summarized by the expected return of the tangency portfolio and the beta of each asset with respect to the tangency portfolio</p></li>
<li><p>Or Alternatively: the risk-return trade-off  of the tangency portfolio  <span class="math notranslate nohighlight">\(\frac{E[R^*]}{Var(R^*)}\)</span> and the covariance of each asset with it.</p></li>
<li><p>Once you have the right notion of risk, the reward to risk is the same across assets (no free lunch)</p></li>
<li><p>What is the right notion? Covariance with the tangency portfolio</p></li>
<li><p>In the sample that you estimated the moments this will be true by construction!</p></li>
</ul>
<p>Now we test if <span class="math notranslate nohighlight">\( E[R^e_j]=\frac{Cov(R^e_j,R^*)}{Var(R^*)}E[R^*] \)</span> in our sample</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Wstar</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Rstar</span><span class="o">=</span><span class="n">Re</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">Rstar</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">Re</span> <span class="o">@</span> <span class="n">Wstar</span>
<span class="n">Rstar</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cov</span><span class="o">=</span><span class="n">Wstar</span> <span class="o">@</span> <span class="n">Re</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
<span class="n">cov</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># expected return of the tangency portfolio</span>
<span class="n">mu_star</span><span class="o">=</span><span class="n">Wstar</span> <span class="o">@</span> <span class="n">Re</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="c1"># variance of the tangency portfolio</span>
<span class="n">var_star</span><span class="o">=</span><span class="p">(</span><span class="n">Wstar</span> <span class="o">@</span> <span class="n">Re</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span> <span class="o">@</span> <span class="n">Wstar</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="c1"># covariance between each asset return and the tangency portfolio</span>
<span class="n">cov</span><span class="o">=</span><span class="n">Wstar</span> <span class="o">@</span> <span class="n">Re</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>

<span class="n">predicted</span><span class="o">=</span> <span class="n">mu_star</span><span class="o">/</span><span class="n">var_star</span><span class="o">*</span><span class="n">cov</span>

<span class="nb">print</span><span class="p">(</span><span class="n">predicted</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">Re</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>This comes from the fact that the tangency portfolio was constructed to be the portfolio with the maximum Sharpe Ratio</p></li>
<li><p>It is a result of us knowing the moments of all assets summarized by <span class="math notranslate nohighlight">\(E[R^e]\)</span>  and <span class="math notranslate nohighlight">\(Var(R^e)\)</span></p></li>
<li><p>Here we did everything IN SAMPLE. We used sample moments and evalauted it’s predictions using the same sample</p></li>
<li><p>The challenge is that these moments are not always well estiamted, to put it mildly (more on this soon!)</p></li>
<li><p>So the in sample tangency portfolio might not be very informative about the true tangency portfolio, which is the one that we actually care about</p></li>
</ul>
<blockquote>
<div><p>Why? Because it can predict returns going forward and not only in sample (which is useless)</p>
</div></blockquote>
</div>
<div class="section" id="portfolio-advice-summary">
<h3>Portfolio advice summary<a class="headerlink" href="#portfolio-advice-summary" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>All investors invest in the same fund of risky assets, regardless of risk aversion.</p></li>
<li><p>Depending on risk aversion, they choose an appropriate mix of money market and risky fund investments</p></li>
<li><p>What about the investment horizon?</p></li>
<li><p>Same portfolio advice applies for investors with longer horizons if we assume that investors are drawn from the same distribution each period</p></li>
<li><p>Your investment horizon (age) does not matter if returns are i.i.d. (independently and identically distributed over time)</p></li>
</ul>
</div>
<div class="section" id="the-1-trillion-dollar-question-what-is-the-tangency-portfolio-how-to-find-it">
<h3>The 1 trillion dollar question: What is the Tangency portfolio? How to find it?<a class="headerlink" href="#the-1-trillion-dollar-question-what-is-the-tangency-portfolio-how-to-find-it" title="Permalink to this headline">¶</a></h3>
</div>
</div>
</div>
<div class="section" id="case-study-on-international-portfolio-diversification">
<h1>Case study on international portfolio diversification<a class="headerlink" href="#case-study-on-international-portfolio-diversification" title="Permalink to this headline">¶</a></h1>
<p>In this section we will apply what we have learned so far on the international market. We will try to solve the optimal weights that give us the highest sharpe ratio, and how we should allocate our money between risk-free rate and risky asset to target on average return or volatility.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>RF</th>
      <th>MKT</th>
      <th>USA30yearGovBond</th>
      <th>EmergingMarkets</th>
      <th>WorldxUSA</th>
      <th>WorldxUSAGovBond</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1963-02-28</th>
      <td>0.0023</td>
      <td>-0.0215</td>
      <td>-0.001878</td>
      <td>0.098222</td>
      <td>-0.002773</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1963-03-31</th>
      <td>0.0023</td>
      <td>0.0331</td>
      <td>0.003342</td>
      <td>0.014149</td>
      <td>0.000371</td>
      <td>0.001913</td>
    </tr>
    <tr>
      <th>1963-04-30</th>
      <td>0.0025</td>
      <td>0.0476</td>
      <td>-0.001843</td>
      <td>-0.147055</td>
      <td>-0.003336</td>
      <td>0.008002</td>
    </tr>
    <tr>
      <th>1963-05-31</th>
      <td>0.0024</td>
      <td>0.0200</td>
      <td>-0.001807</td>
      <td>-0.012172</td>
      <td>-0.000186</td>
      <td>0.004689</td>
    </tr>
    <tr>
      <th>1963-06-30</th>
      <td>0.0023</td>
      <td>-0.0177</td>
      <td>0.001666</td>
      <td>-0.055699</td>
      <td>-0.011160</td>
      <td>0.003139</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for convenience lets rename these assets</span>

<span class="n">Data</span><span class="o">=</span><span class="n">Data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">Data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="s2">&quot;MKTUS&quot;</span><span class="p">,</span><span class="n">Data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="s2">&quot;BondUS&quot;</span><span class="p">,</span>
                          <span class="n">Data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="s2">&quot;EM&quot;</span><span class="p">,</span><span class="n">Data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s2">&quot;MKTxUS&quot;</span><span class="p">,</span><span class="n">Data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="s2">&quot;BondxUS&quot;</span> <span class="p">})</span>
<span class="n">Data</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>RF</th>
      <th>MKTUS</th>
      <th>BondUS</th>
      <th>EM</th>
      <th>MKTxUS</th>
      <th>BondxUS</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2016-08-31</th>
      <td>0.0002</td>
      <td>0.0052</td>
      <td>-0.008417</td>
      <td>0.025186</td>
      <td>0.000838</td>
      <td>-0.009552</td>
    </tr>
    <tr>
      <th>2016-09-30</th>
      <td>0.0002</td>
      <td>0.0027</td>
      <td>-0.016417</td>
      <td>0.013153</td>
      <td>0.012736</td>
      <td>0.009979</td>
    </tr>
    <tr>
      <th>2016-10-31</th>
      <td>0.0002</td>
      <td>-0.0200</td>
      <td>-0.049460</td>
      <td>0.002474</td>
      <td>-0.020383</td>
      <td>-0.043476</td>
    </tr>
    <tr>
      <th>2016-11-30</th>
      <td>0.0001</td>
      <td>0.0487</td>
      <td>-0.081636</td>
      <td>-0.045971</td>
      <td>-0.019798</td>
      <td>-0.050359</td>
    </tr>
    <tr>
      <th>2016-12-31</th>
      <td>0.0003</td>
      <td>0.0185</td>
      <td>-0.005296</td>
      <td>0.002904</td>
      <td>0.034383</td>
      <td>-0.023207</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># lets start by constructing a matrix with only excess returns</span>
<span class="n">Re</span><span class="o">=</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">Data</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="n">Re</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MKTUS</th>
      <th>BondUS</th>
      <th>EM</th>
      <th>MKTxUS</th>
      <th>BondxUS</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2016-08-31</th>
      <td>0.0050</td>
      <td>-0.008617</td>
      <td>0.024986</td>
      <td>0.000638</td>
      <td>-0.009752</td>
    </tr>
    <tr>
      <th>2016-09-30</th>
      <td>0.0025</td>
      <td>-0.016617</td>
      <td>0.012953</td>
      <td>0.012536</td>
      <td>0.009779</td>
    </tr>
    <tr>
      <th>2016-10-31</th>
      <td>-0.0202</td>
      <td>-0.049660</td>
      <td>0.002274</td>
      <td>-0.020583</td>
      <td>-0.043676</td>
    </tr>
    <tr>
      <th>2016-11-30</th>
      <td>0.0486</td>
      <td>-0.081736</td>
      <td>-0.046071</td>
      <td>-0.019898</td>
      <td>-0.050459</td>
    </tr>
    <tr>
      <th>2016-12-31</th>
      <td>0.0182</td>
      <td>-0.005596</td>
      <td>0.002604</td>
      <td>0.034083</td>
      <td>-0.023507</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># now we estimate the expected return and the covariance using the sample moments</span>
<span class="n">ERe</span><span class="o">=</span><span class="n">Re</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">ERe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MKTUS      0.005140
BondUS     0.002523
EM         0.006923
MKTxUS     0.004149
BondxUS    0.002054
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Cove</span><span class="o">=</span><span class="n">Re</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
<span class="n">Cove</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MKTUS</th>
      <th>BondUS</th>
      <th>EM</th>
      <th>MKTxUS</th>
      <th>BondxUS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MKTUS</th>
      <td>0.001948</td>
      <td>0.000111</td>
      <td>0.001292</td>
      <td>0.001264</td>
      <td>0.000187</td>
    </tr>
    <tr>
      <th>BondUS</th>
      <td>0.000111</td>
      <td>0.001227</td>
      <td>-0.000204</td>
      <td>-0.000013</td>
      <td>0.000264</td>
    </tr>
    <tr>
      <th>EM</th>
      <td>0.001292</td>
      <td>-0.000204</td>
      <td>0.003556</td>
      <td>0.001661</td>
      <td>0.000249</td>
    </tr>
    <tr>
      <th>MKTxUS</th>
      <td>0.001264</td>
      <td>-0.000013</td>
      <td>0.001661</td>
      <td>0.002182</td>
      <td>0.000422</td>
    </tr>
    <tr>
      <th>BondxUS</th>
      <td>0.000187</td>
      <td>0.000264</td>
      <td>0.000249</td>
      <td>0.000422</td>
      <td>0.000407</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ol class="simple">
<li><p>First we will solve for the maxium Sharpe ratio feasible:</p></li>
</ol>
<ul class="simple">
<li><p>What is this? It is the SR on the tangency  portfolio</p></li>
<li><p>(I am using <span class="math notranslate nohighlight">\(W_*\)</span> to denote it to make it easier to show the transposes)</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\begin{align}
  SR(R^*)&amp;=\frac{E[W_*'R^e]}{\sqrt{Var(W_*'R^e)}}\\
  &amp;=\frac{W_*'E[R^e]}{\sqrt{W_*'Var(R^e)W_*}}\\
  &amp;=\frac{(Var(R^e)^{-1}E[R^e])'E[R^e]}{\sqrt{(Var(R^e)^{-1}E[R^e])'Var(R^e)(Var(R^e)^{-1}E[R^e])}}\\
  &amp;=\frac{E[R^e]'Var(R^e)^{-1}E[R^e]}{\sqrt{E[R^e]'Var(R^e)^{-1}Var(R^e)Var(R^e)^{-1}E[R^e]}}\\
  &amp;=\frac{E[R^e]'Var(R^e)^{-1}E[R^e]}{\sqrt{E[R^e]'Var(R^e)^{-1}E[R^e]}}\\
  &amp;=\sqrt{E[R^e]'Var(R^e)^{-1}E[R^e]}
  \end{align}\)</span></p>
<ol class="simple">
<li><p>Then we will solve for the weights that implement this Sharpe ratio</p></li>
</ol>
<div class="math notranslate nohighlight">
\[W_*=VAR(R^e)^{-1}E[R^e]\]</div>
<ol class="simple">
<li><p>And then we will solve for the position on it that implements a desired level of expected excess returns</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ERe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MKTUS      0.005140
BondUS     0.002523
EM         0.006923
MKTxUS     0.004149
BondxUS    0.002054
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SR_int</span><span class="o">=</span><span class="p">(</span><span class="n">ERe</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Cove</span><span class="p">)</span> <span class="o">@</span> <span class="n">ERe</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
<span class="n">SR_int</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.16368754895405602
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># annualized</span>

<span class="n">SR_int</span><span class="o">*</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5670303027096857
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compares with market</span>

<span class="n">Re</span><span class="o">.</span><span class="n">MKTUS</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="n">Re</span><span class="o">.</span><span class="n">MKTUS</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.40345097267659175
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Wmve</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([],</span><span class="n">index</span><span class="o">=</span><span class="n">Re</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">Wmve</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MKTUS</th>
    </tr>
    <tr>
      <th>BondUS</th>
    </tr>
    <tr>
      <th>EM</th>
    </tr>
    <tr>
      <th>MKTxUS</th>
    </tr>
    <tr>
      <th>BondxUS</th>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># construct the optimal weights</span>

<span class="n">Wmve</span><span class="p">[</span><span class="s1">&#39;wghts_int&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Cove</span><span class="p">)</span> <span class="o">@</span> <span class="n">ERe</span><span class="o">.</span><span class="n">values</span>

<span class="n">Wmve</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wghts_int</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MKTUS</th>
      <td>1.835334</td>
    </tr>
    <tr>
      <th>BondUS</th>
      <td>1.423373</td>
    </tr>
    <tr>
      <th>EM</th>
      <td>1.605223</td>
    </tr>
    <tr>
      <th>MKTxUS</th>
      <td>-1.026421</td>
    </tr>
    <tr>
      <th>BondxUS</th>
      <td>3.365823</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="section" id="class-11-17-stopped-here">
<h2>Class 11/17 stopped here<a class="headerlink" href="#class-11-17-stopped-here" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>To find the weights that implement a particular expected return target</p>
<p><span class="math notranslate nohighlight">\(\begin{align}
\mu^{target}&amp;=r_f+(1-w_f)E[R^*] \\
(1-w_f)&amp;=\frac{\mu^{target}-r_f}{E[R^*]} \\
&amp;=\frac{\mu^{target}-r_f}{W_*'E[R^e]} \\
&amp;=\frac{\mu^{target}-r_f}{(VAR(R^e)^{-1}E[R^e])'E[R^e]} \\
&amp;=\frac{\mu^{target}-r_f}{E[R^e]'Var(R^e)^{-1}E[R^e]} \\
\end{align}\)</span></p>
</li>
</ul>
<blockquote>
<div><p>How to choose <span class="math notranslate nohighlight">\(w_f\)</span> by targeting a desired level of vol?</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ERe</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Cove</span><span class="p">)</span> <span class="o">@</span> <span class="n">ERe</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.3215233641910378
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># target ER (excess return)</span>

<span class="n">mu_target</span><span class="o">=</span><span class="mf">0.10</span><span class="o">/</span><span class="mi">12</span>
<span class="n">oneminuswf</span><span class="o">=</span><span class="p">(</span><span class="n">mu_target</span><span class="o">/</span><span class="p">(</span><span class="n">ERe</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Cove</span><span class="p">)</span> <span class="o">@</span> <span class="n">ERe</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">oneminuswf</span><span class="p">)</span>
<span class="c1"># Here lamb is our 1-wf, which is the total dollar value invested in the risky portfolio</span>

<span class="c1"># must </span>
<span class="n">Wmve</span><span class="p">[</span><span class="s1">&#39;wgths_int_target&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">oneminuswf</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Cove</span><span class="p">)</span> <span class="o">@</span> <span class="n">ERe</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">Wmve</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.3110193881293913
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wghts_int</th>
      <th>wgths_int_target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MKTUS</th>
      <td>1.835334</td>
      <td>0.570824</td>
    </tr>
    <tr>
      <th>BondUS</th>
      <td>1.423373</td>
      <td>0.442696</td>
    </tr>
    <tr>
      <th>EM</th>
      <td>1.605223</td>
      <td>0.499255</td>
    </tr>
    <tr>
      <th>MKTxUS</th>
      <td>-1.026421</td>
      <td>-0.319237</td>
    </tr>
    <tr>
      <th>BondxUS</th>
      <td>3.365823</td>
      <td>1.046836</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>lets compute the domestic mean-variance frontier</p>
<p>(we only keep the first two columns MKT +Bonds)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ERdom</span><span class="o">=</span><span class="n">Re</span><span class="p">[[</span><span class="s1">&#39;MKTUS&#39;</span><span class="p">,</span><span class="s1">&#39;BondUS&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">Covdom</span><span class="o">=</span><span class="n">Re</span><span class="p">[[</span><span class="s1">&#39;MKTUS&#39;</span><span class="p">,</span><span class="s1">&#39;BondUS&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
<span class="n">SR_dom</span><span class="o">=</span><span class="p">(</span><span class="n">ERdom</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Covdom</span><span class="p">)</span> <span class="o">@</span> <span class="n">ERdom</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
<span class="nb">print</span><span class="p">(</span><span class="n">SR_dom</span><span class="o">*</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">Wmvedom</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Covdom</span><span class="p">)</span> <span class="o">@</span> <span class="n">ERdom</span><span class="o">.</span><span class="n">values</span>
<span class="n">Wmve</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;MKTUS&#39;</span><span class="p">,</span><span class="s1">&#39;BondUS&#39;</span><span class="p">],</span><span class="s1">&#39;wghts_dom&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">Wmvedom</span>
<span class="n">Wmve</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.46009875470841877
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wghts_int</th>
      <th>wgths_int_target</th>
      <th>wghts_dom</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MKTUS</th>
      <td>1.835334</td>
      <td>0.570824</td>
      <td>2.534954</td>
    </tr>
    <tr>
      <th>BondUS</th>
      <td>1.423373</td>
      <td>0.442696</td>
      <td>1.827591</td>
    </tr>
    <tr>
      <th>EM</th>
      <td>1.605223</td>
      <td>0.499255</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>MKTxUS</th>
      <td>-1.026421</td>
      <td>-0.319237</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>BondxUS</th>
      <td>3.365823</td>
      <td>1.046836</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="aside-when-is-it-ok-to-normalize-weights">
<h2>Aside: When is it ok to “normalize” weights?<a class="headerlink" href="#aside-when-is-it-ok-to-normalize-weights" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>To get a bit of intuition we can normalize the weights to add up to 1</p></li>
<li><p>Why these weights do not have to add up to 1?</p></li>
<li><p>Why is ok to normalize to 1?</p></li>
<li><p>What changes when we do that? What does not change?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Wmve</span><span class="o">/</span><span class="n">Wmve</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wghts_int</th>
      <th>wgths_int_target</th>
      <th>wghts_dom</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MKTUS</th>
      <td>0.254790</td>
      <td>0.254790</td>
      <td>0.581072</td>
    </tr>
    <tr>
      <th>BondUS</th>
      <td>0.197599</td>
      <td>0.197599</td>
      <td>0.418928</td>
    </tr>
    <tr>
      <th>EM</th>
      <td>0.222844</td>
      <td>0.222844</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>MKTxUS</th>
      <td>-0.142493</td>
      <td>-0.142493</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>BondxUS</th>
      <td>0.467259</td>
      <td>0.467259</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># this difference is the benefits of international diversification</span>

<span class="p">(</span><span class="n">SR_int</span><span class="o">-</span><span class="n">SR_dom</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.10693154800126692
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>what does that mean?</p></li>
<li><p>it means for example that if you want to target a portfolio with a volatility of 5% per month (about the vol of the US market portfolio), then you get</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SR_int_y</span><span class="o">=</span><span class="n">SR_int</span><span class="o">*</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span>
<span class="n">SR_dom_y</span><span class="o">=</span><span class="n">SR_dom</span><span class="o">*</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SR_dom_y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.46009875470841877
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># international diversification</span>
<span class="n">voltarget</span><span class="o">=</span><span class="mf">0.1</span>
<span class="p">[</span><span class="n">SR_int_y</span><span class="o">*</span><span class="n">voltarget</span><span class="p">,</span><span class="n">SR_dom_y</span><span class="o">*</span><span class="n">voltarget</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.05670303027096857, 0.04600987547084188]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># annualized  your returns increase by </span>
<span class="p">(</span><span class="n">SR_int_y</span><span class="o">*</span><span class="n">voltarget</span> <span class="o">-</span><span class="n">SR_dom_y</span><span class="o">*</span><span class="n">voltarget</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.01069315480012669
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># in percentual increase it is very meaningful</span>
<span class="p">(</span><span class="n">SR_int_y</span><span class="o">*</span><span class="n">voltarget</span> <span class="o">-</span><span class="n">SR_dom_y</span><span class="o">*</span><span class="n">voltarget</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">SR_dom_y</span><span class="o">*</span><span class="n">voltarget</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.23240999221793873
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./chapters/Finance"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Alan Moreira<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>